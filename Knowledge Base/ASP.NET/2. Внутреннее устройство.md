## JIT

### JIT-компиляция (кратко)

Как выше писалось, код на C# компилируется в приложения или сборки с расширениями exe или dll на языке CIL. Далее при запуске на выполнение подобного приложения происходит JIT-компиляция (Just-In-Time) в машинный код, который затем выполняется. При этом, поскольку наше приложение может быть большим и содержать кучу инструкций, в текущий момент времени будет компилироваться лишь та часть приложения, к которой непосредственно идет обращение. Если мы обратимся к другой части кода, то она будет скомпилирована из CIL в машинный код. При том уже скомпилированная часть приложения сохраняется до завершения работы программы. В итоге это повышает производительность.

### Что такое JIT?

**JIT** **(Just-In-Time Compilation)** — это компонент среды выполнения **CLR (Common Language Runtime)**, который компилирует IL (Intermediate Language, он же MSIL или CIL) код в машинный код непосредственно перед выполнением.

Когда ты компилируешь ASP.NET приложение (или любое приложение .NET), C# код сначала превращается в **IL**, который независим от конкретной платформы. А уже когда приложение запускается, JIT компилятор берет IL и компилирует его в машинный код, который будет исполняться конкретным процессором на конкретной машине.

### Как это работает в ASP.NET:

1. **Во время первого запроса или запуска приложения:**
    
    - При первом вызове метода или использовании класса JIT компилирует соответствующий IL в нативный код.
    
    - После компиляции этот код кэшируется в памяти, и при последующих вызовах метода используется уже готовый машинный код без повторной JIT-компиляции.

2. **JIT работает частично:**
    
    - JIT компилирует **не весь код приложения сразу**, а только тот код, который реально начинает исполняться.
    
    - Это позволяет быстрее запустить приложение (меньше времени на старте), но может давать задержки во время выполнения, когда происходит JIT компиляция новых кусков IL.

---

### Почему это важно для ASP.NET?

1. **Теплый старт vs холодный старт:**
    
    - При первом запуске (например, после деплоя или рестарта приложения) часть времени будет уходить на JIT-компиляцию.
    
    - Особенно это чувствуется на больших ASP.NET Core приложениях — старт медленный, пока JIT не скомпилирует нужные куски кода.
    
2. **Производительность:**
    
    - После того как JIT скомпилировал IL в нативный код, дальнейшие запросы будут выполняться быстрее, так как уже будет работать нативный код без промежуточной компиляции.
    
3. **JIT + Hot Code Paths:**
    
    - JIT умеет оптимизировать "горячие" участки кода (например, часто вызываемые контроллеры или сервисы), применяя более агрессивные оптимизации.

---

### Минусы JIT в ASP.NET:

- Медленный холодный старт приложения.
    
- Дополнительные накладные расходы на компиляцию в runtime.
    
- Неопределенность в поведении (разное поведение на разных архитектурах, если оптимизации JIT-а различаются).

## .NET Standard

**.NET Standard** — это спецификация API, которая определяет единый набор библиотек и базовых типов, доступных для различных реализаций платформы .NET (например, .NET Framework, .NET Core, Xamarin и других).

### Основная цель:

Обеспечить **кроссплатформенность** и **совместимость библиотек** между разными реализациями .NET.

### Почему это важно?

Раньше библиотека, написанная под .NET Framework, не обязательно работала под .NET Core или Xamarin. Чтобы решить эту проблему, появился .NET Standard — единый контракт, которому должны соответствовать все платформы.

### Пример:

Если библиотека соответствует `.NET Standard 2.0`, то она будет работать на любой платформе, которая поддерживает этот стандарт:

- .NET Framework 4.6.1+
- .NET Core 2.0+
- Xamarin
- Unity (в новых версиях)

**Важно:** начиная с .NET 5, .NET Standard постепенно уходит на второй план, так как сама платформа стала унифицированной.

## CLR (Common Language Runtime)

**CLR** — это виртуальная машина и основа всей платформы .NET. Именно CLR выполняет управляемый код и предоставляет такие возможности, как:

### Основные функции CLR:

- **JIT-компиляция**: превращает IL-код в машинный код.

- **Сборка мусора (GC)**: автоматическое управление памятью.

- **Обработка исключений**: унифицированный механизм try/catch.

- **Безопасность кода**: верификация и sandbox-модели.

- **Поддержка потоков**: создание и управление многопоточностью.

- **Работа с метаданными**: загрузка и взаимодействие с типами и сборками.

CLR абстрагирует разработчика от низкоуровневых деталей работы с памятью и железом, предоставляя мощный и безопасный runtime.

---

## CTS (Common Type System)

**CTS** — это спецификация, которая определяет, какие **типы данных** поддерживает платформа .NET.

Цель CTS — чтобы все .NET-языки (C#, F#, VB.NET и другие) могли использовать одни и те же базовые типы и беспрепятственно взаимодействовать между собой.

### Примеры CTS-типов:

- Примитивы: `int`, `float`, `bool`, `char`

- Ссылочные типы: `object`, `string`, массивы

- Пользовательские классы, интерфейсы и структуры

- Обобщенные типы `List<T>`, `Dictionary<TKey, TValue>` и т.д.

### CTS решает проблему:

Если на одном языке объявлен тип `int` (C#), а на другом — `Integer` (VB.NET), то для CLR это один и тот же тип из CTS (`System.Int32`).

---

## CLS (Common Language Specification)

**CLS** — это набор правил и ограничений, который определяет минимальный подмножество возможностей .NET, обязательный для соблюдения всеми .NET-языками.

### Проще говоря:

Если твой код **CLS-совместим**, значит он может быть безопасно использован из любого другого .NET-языка.

### Примеры ограничений CLS:

- Нельзя использовать `uint` (беззнаковый `int`), потому что не все языки .NET его поддерживают.

- Имена методов должны отличаться не только регистром (например, `DoWork()` и `dowork()` нарушают CLS).

- Все параметры и возвращаемые значения должны быть CLS-совместимыми типами.

### Зачем это нужно:

Это особенно полезно при создании библиотек общего пользования (shared libraries), которые могут использовать разработчики на других .NET-языках.
